<html>
<head>
<script src="warrenbuffer.js"></script>
<style>
  /************* "Atomic CSS" classes for Boxes *************/
  .💪 { display: flex }                                 /* Flex like muscles.   */
  .🥷 { overflow: hidden }
  .🪜 { flex-flow: column }
  .🌳 { flex: 1 }                                       /* Grow like a tree.    */
  .🦠 { justify-content: space-between }                /* Stay spread apart.   */

  /*** Classes for WarrenBuffer ***/
  .wb {
      position: relative;
      outline: none;
      font-family: monospace;
      border: 1px solid black;
  }
  .no-select {
      user-select: none;       /* Standard */
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none;    /* Firefox */
      -ms-user-select: none;     /* IE/Edge (old) */
  }
  .wb .wb-lines>pre::before {
      content: "\200B";
  }
  .wb .wb-lines pre {
      margin: 0;
      overflow: hidden;
  }
  .wb .wb-selection {
      left: 0ch;
      top: 0ch;
      background-color: green;;
      position: absolute;
      opacity: .7;
  }
  .wb .wb-status span {
      padding-right: 4px;
  }
</style>
</head>

<body>
<details>
  <summary>Playground Harness</summary>
  <label for="viewport-start">Viewport Start: </label>
  <input id="viewport-start" value="0"></input>
  <label for="viewport-size">Viewport Size:</label>
  <input id="viewport-size" value="10"></input>
  <button id="viewport-update">Update viewport</button>
  <button id="viewport-scroll-up-1">Scroll -1</button>
  <button id="viewport-scroll-down-1">Scroll +1</button>
  <hr />
  <input id="file-input" type="file" name="myFiles">
  total size: <span id="fileSize">0</span>
  <div>
    <button id="load-file">Load File</button>
  </div>
  <div>
    <button id="append-file">Append File</button><br />
    Append at Line number: <input id="append-at-line" value="1"></input>
  </div>
</details>
  <blockquote cite="" class="💪 🍜 🥷 🌕 🪜 wb no-select" tabindex="0">
      <div class="💪">
          <div class="wb-gutter"></div>
          <div class="wb-lines 🌳 🥷"></div>
      </div>
      <div class="💪 wb-status 🦠">
          <div class="wb-status-left 💪">
              <span class="wb-linecount"></span>
          </div>
          <div class="wb-status-right 💪">
              <span class="wb-coordinate"></span>
              <span>|</span>
              <span class="wb-indentation"></span>
          </div>
      </div>
  </blockquote>
  <script type="text/javascript">
    const node = document.querySelector(".wb"); <!-- This is unambiguous if only 1 instance -->
    const textDocument = "This is my first text document\nWoohoo\nFoobar\njfdhfjhfdg\njfdhj\ndh";
    const warrenBuffer = new WarrenBuffer(node);
    warrenBuffer.Model.text = textDocument;

    // Bind UI controls to move viewport
    document.getElementById('viewport-update').addEventListener('click', () => {
      const viewportStart = parseInt(document.getElementById('viewport-start').value);
      const viewportSize = parseInt(document.getElementById('viewport-size').value);
      warrenBuffer.Viewport.set(viewportStart, viewportSize);
    });
    document.getElementById('viewport-scroll-up-1').addEventListener('click', () => {
      warrenBuffer.Viewport.scroll(-1);
    });
    document.getElementById('viewport-scroll-down-1').addEventListener('click', () => {
      warrenBuffer.Viewport.scroll(1);
    });

    document.getElementById("file-input").addEventListener("change", () => {
      const file = this.files[0];
      const nBytes = file.size;
      const aMultiples = ["KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "ZiB", "YiB"];
      let sOutput = "";
      for (nMultiple = 0, nApprox = nBytes / 1024; nApprox > 1; nApprox /= 1024, nMultiple++) {
        sOutput = nApprox.toFixed(3) + " " + aMultiples[nMultiple] + " (" + nBytes + " bytes)";
      }
      document.getElementById("fileSize").innerHTML = sOutput || (nBytes + " bytes");
    }, false);
    document.getElementById('load-file').addEventListener('click', () => {
      const t0 = performance.now();
      const f = document.getElementById("file-input").files[0];
      if (!f) {
        alert("No file selected");
      } else {
        f.text().then(text => {
          warrenBuffer.Model.text = text;
          const t1 = performance.now();
          console.log(`Reading file took ${t1 - t0} millis.`);
        });
      }
    });
    document.getElementById('append-file').addEventListener('click', () => {
      const lineNumber = parseInt(document.getElementById('append-at-line').value);
      const f = document.getElementById("file-input").files[0];
      if (!f) {
        alert("No file selected");
      } else {
        f.text().then(text => {
          const s = text.split("\n");
          const t0 = performance.now();
          warrenBuffer.Model.splice(lineNumber, s);
          const t1 = performance.now();
          console.log(`Took ${parseFloat(t1 - t0).toFixed(2)} millis to splice ${s.length.toLocaleString()} elements at ${index.toLocaleString()} w/ ${warrenBuffer.Model.lc.toLocaleString()} lines.`);
        });
      }
    });
  </script>
</body>
</html>