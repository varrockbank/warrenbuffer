<html>
<head>
<script src="warrenbuffer.js"></script>
<style>
  /************* Boxes *************/
  .ðŸ’ª { display: flex }                                 /* Flex like muscles.   */
  .ðŸ¥· { overflow: hidden }
  .ðŸªœ { flex-flow: column }
  .ðŸŒ³ { flex: 1 }                                       /* Grow like a tree.    */

  /************* Legendary Buffer
ðŸ¦„ : The Legend
ðŸŒ® : Lines *up for tacos*
ðŸ§¹ : cursed / cursor
ðŸ’¸ : status bar
/*********************************/
  .ðŸ¦„ {
      position: relative;
      outline: none;
      font-family: monospace;
      border: 1px solid black;
  }
  .ðŸ¦„ .ðŸŒ®>pre::before {
      content: "\200B";
  }
  .ðŸ¦„ .ðŸŒ® pre {
      margin: 0;
      overflow: hidden;
  }
  .ðŸ¦„ .ðŸ’¸ {
      padding: 6px;
      background: black;
      color: white;
  }
  .ðŸ¦„ .ðŸ§¹ {
      left: 0ch;
      top: 0ch;
      background-color: green;;
      position: absolute;
      opacity: .7;
  }
</style>
</head>

<body>
<details>
  <summary>Playground Harness</summary>
  <label for="viewport-start">Viewport Start: </label>
  <input id="viewport-start" value="0"></input>
  <label for="viewport-size">Viewport Size:</label>
  <input id="viewport-size" value="10"></input>
  <button id="viewport-update">Update viewport</button>
  <button id="viewport-scroll-up-1">Scroll -1</button>
  <button id="viewport-scroll-down-1">Scroll +1</button>
  <hr />
  <input id="file-input" type="file" name="myFiles">
  total size: <span id="fileSize">0</span>
  <div>
    <button id="load-file">Load File</button>
  </div>
  <div>
    <button id="append-file">Append File</button><br />
    Append at Line number: <input id="append-at-line" value="1"></input>
  </div>
</details>
  <blockquote cite="" class="ðŸ’ª ðŸœ ðŸ¥· ðŸŒ• ðŸªœ ðŸ¦„" id="buffer-container">
      <div class="ðŸ’ª">
          <div class="gutter" style="padding-top: 5px"></div>
          <!-- position relative forces the selections to be relative to this,
         rather than the parent container -->
          <div class="ðŸŒ® ðŸŒ³ ðŸ¥·"
               style="position: relative; margin-left: 4px; margin-top: 4px">
              <pre>Another block</pre>
              <pre>Second line</pre>
              <pre>Third line</pre>
          </div>
      </div>
      <div class="ðŸ’ª ðŸ’¸">Line count: <span class="ðŸ§›"></span></div>
  </blockquote>
  <script type="text/javascript">
    const node = document.getElementById("buffer-container");
    const textDocument = "This is my first text document\nWoohoo\nFoobar\njfdhfjhfdg\njfdhj\ndh";
    const warrenBuffer = new WarrenBuffer(node);
    warrenBuffer.Model.text = textDocument;

    // Bind UI controls to move viewport
    document.getElementById('viewport-update').addEventListener('click', () => {
      const viewportStart = parseInt(document.getElementById('viewport-start').value);
      const viewportSize = parseInt(document.getElementById('viewport-size').value);
      warrenBuffer.Viewport.set(viewportStart, viewportSize);
    });
    document.getElementById('viewport-scroll-up-1').addEventListener('click', () => {
      warrenBuffer.Viewport.scroll(-1);
    });
    document.getElementById('viewport-scroll-down-1').addEventListener('click', () => {
      warrenBuffer.Viewport.scroll(1);
    });
    // Bind keyboard control to move viewport
    document.addEventListener('keydown', event => {
      if (event.key === "ArrowDown") {
        warrenBuffer.Viewport.scroll(1);
      } else if (event.key === "ArrowUp") {
        warrenBuffer.Viewport.scroll(-1);
      } else if (event.key === "ArrowLeft") {
        warrenBuffer.Cursor.scroll(-1);
      }
    });

    document.getElementById("file-input").addEventListener("change", () => {
      const file = this.files[0];
      const nBytes = file.size;
      const aMultiples = ["KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "ZiB", "YiB"];
      let sOutput = "";
      for (nMultiple = 0, nApprox = nBytes / 1024; nApprox > 1; nApprox /= 1024, nMultiple++) {
        sOutput = nApprox.toFixed(3) + " " + aMultiples[nMultiple] + " (" + nBytes + " bytes)";
      }
      document.getElementById("fileSize").innerHTML = sOutput || (nBytes + " bytes");
    }, false);
    document.getElementById('load-file').addEventListener('click', () => {
      const t0 = performance.now();
      const f = document.getElementById("file-input").files[0];
      if (!f) {
        alert("No file selected");
      } else {
        f.text().then(text => {
          warrenBuffer.Model.text = text;
          const t1 = performance.now();
          console.log(`Reading file took ${t1 - t0} millis.`);
        });
      }
    });
    document.getElementById('append-file').addEventListener('click', () => {
      const lineNumber = parseInt(document.getElementById('append-at-line').value);
      const f = document.getElementById("file-input").files[0];
      if (!f) {
        alert("No file selected");
      } else {
        f.text().then(text => {
          const s = text.split("\n");
          const t0 = performance.now();
          warrenBuffer.Model.splice(lineNumber, s);
          const t1 = performance.now();
          console.log(`Took ${parseFloat(t1 - t0).toFixed(2)} millis to splice ${s.length.toLocaleString()} elements at ${index.toLocaleString()} w/ ${warrenBuffer.Model.lc.toLocaleString()} lines.`);
        });
      }
    });
  </script>
</body>
</html>